<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MU Immortal - Event Timers (UTC+1)</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #111; color: #eee; padding: 20px; }
    h1, h2 { color: #f39c12; }
    .event-list { display: flex; flex-wrap: wrap; gap: 40px; }
    .event-box { border: 1px solid #444; padding: 10px 20px; border-radius: 8px; background-color: #1e1e1e; min-width: 300px; }
    .event { margin: 10px 0; padding: 5px; border-bottom: 1px solid #333; }
    .event:last-child { border-bottom: none; }
    .event-name { font-weight: bold; }
    .event-time, .event-timer { font-size: 0.9em; color: #aaa; }
    .up-next { margin: 20px 0; font-size: 1.2em; color: #0f0; }
  </style>
</head>
<body>
  <h1>MU Immortal - Event Timers (UTC+1)</h1>
  <div id="up-next" class="up-next"></div>
  <div id="user-timezone"></div>
  <div class="event-list">
    <div id="daily-events" class="event-box">
      <h2>Daily Events</h2>
    </div>
    <div id="weekly-events" class="event-box">
      <h2>Weekly Events</h2>
    </div>
  </div>
  <script>
    const events = [
      { name: "Blood Castle", times: generateEvery2Hours("00:00", "22:00"), dayAbbr: [] },
      { name: "Devil Square", times: generateEvery2Hours("01:00", "23:00"), dayAbbr: [] },
      { name: "Red Dragon Invasion", times: ["10:30", "13:30", "16:30", "21:30"], dayAbbr: [] },
      { name: "Guild Master Event", times: ["11:30", "19:30"], dayAbbr: [] },
      { name: "Minion EXP +30%", times: ["00:00"], durationHours: 8, dayAbbr: [] },
      { name: "Cross-server 3v3", times: ["12:00", "23:30"], dayAbbr: [] },
      { name: "Crywolf Fortress", times: ["20:30"], dayAbbr: ["Mon"] },
      { name: "Chaos Castle", times: ["20:00"], dayAbbr: ["Tue"] },
      { name: "Siege War", times: ["20:00"], dayAbbr: ["Wed", "Sat"] },
      { name: "[Summer event] Frost Lord", times: ["12:10", "18:30"], dayAbbr: [] },
    ];

    function generateEvery2Hours(start, end) {
      const times = [];
      let [sh, sm] = start.split(":").map(Number);
      let [eh, em] = end.split(":").map(Number);
      for (let h = sh; h <= eh; h += 2) {
        times.push(`${String(h).padStart(2, "0")}:${String(sm).padStart(2, "0")}`);
      }
      return times;
    }

    const userTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
    document.getElementById("user-timezone").textContent = `Your Timezone: ${userTz}`;

    const upNextDiv = document.getElementById("up-next");

    function getEventDateFromUTCPlus1(dayDate, timeStr) {
      const [hour, minute] = timeStr.split(":").map(Number);
      const utcDate = new Date(Date.UTC(
        dayDate.getFullYear(),
        dayDate.getMonth(),
        dayDate.getDate(),
        hour - 1,
        minute,
        0,
        0
      ));
      return new Date(utcDate.getTime());
    }
    function getNextEventTimes(event) {
      const now = new Date();
      const upcoming = [];

      for (let offset = 0; offset < 8; offset++) {
        const day = new Date(now);
        day.setDate(now.getDate() + offset);
        const dayAbbr = day.toLocaleDateString('en-US', { weekday: 'short' });
        if (event.dayAbbr.length && !event.dayAbbr.includes(dayAbbr)) continue;

        for (const t of event.times) {
          const dt = getEventDateFromUTCPlus1(day, t);
          if (dt >= now) upcoming.push(dt);
        }
        if (upcoming.length) break;
      }
      return upcoming.sort((a,b) => a-b);
    }

    function formatTimeLocal(date) {
      return date.toLocaleTimeString([], { hour12: false, hour: "2-digit", minute: "2-digit" });
    }
    function formatTimeUTCPlus1(date) {
      const utcHour = date.getUTCHours();
      const utcMin = date.getUTCMinutes();
      let hour = utcHour + 1;
      let dayAdjust = 0;
      if (hour >= 24) {
        hour -= 24;
        dayAdjust = 1;
      }
      return `${String(hour).padStart(2,"0")}:${String(utcMin).padStart(2,"0")}`;
    }

    function formatCountdown(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      return `${days}d ${hours}h ${minutes}m`;
    }

    function renderEvents(container, filterFn) {
      container.querySelectorAll(".event").forEach(e => e.remove());
      for (const event of events.filter(filterFn)) {
        const nextTimes = getNextEventTimes(event);
        if (!nextTimes.length) continue;

        const localTime = formatTimeLocal(nextTimes[0]);
        const utcPlus1Time = formatTimeUTCPlus1(nextTimes[0]);
        const timeDiff = nextTimes[0] - new Date();

        const div = document.createElement("div");
        div.className = "event";
        div.innerHTML = `
          <div class="event-name">${event.name}</div>
          <div class="event-time">Local: ${localTime} | UTC+1: ${utcPlus1Time}</div>
          <div class="event-timer">Starts in: ${formatCountdown(timeDiff)}</div>
        `;
        container.appendChild(div);
      }
    }

    function showNextUpcoming() {
      const now = new Date();
      let soonest = null;
      let soonestEvent = null;

      for (const event of events) {
        const upcoming = getNextEventTimes(event);
        if (!upcoming.length) continue;
        if (!soonest || upcoming[0] < soonest) {
          soonest = upcoming[0];
          soonestEvent = event;
        }
      }

      if (soonestEvent && soonest) {
        const localTime = formatTimeLocal(soonest);
        const utcPlus1Time = formatTimeUTCPlus1(soonest);
        const timeDiff = soonest - now;

        upNextDiv.innerHTML = `Next Event: <strong>${soonestEvent.name}</strong> at Local: ${localTime} | UTC+1: ${utcPlus1Time} (in ${formatCountdown(timeDiff)})`;
      } else {
        upNextDiv.textContent = "No upcoming events.";
      }
    }
    showNextUpcoming();
    renderEvents(document.getElementById("daily-events"), e => e.dayAbbr.length === 0);
    renderEvents(document.getElementById("weekly-events"), e => e.dayAbbr.length > 0);

    setInterval(() => {
      showNextUpcoming();
      renderEvents(document.getElementById("daily-events"), e => e.dayAbbr.length === 0);
      renderEvents(document.getElementById("weekly-events"), e => e.dayAbbr.length > 0);
    }, 60000);
  </script>
</body>
</html>
