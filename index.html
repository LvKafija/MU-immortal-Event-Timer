<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MU Immortal - Next Events</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
    }
    .container {
      background: #1e1e1e;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0, 255, 255, 0.2);
      max-width: 400px;
    }
    h1 { color: #00ffff; }
    .time { font-size: 1.2em; margin-top: 10px; }
    .event-box { margin-top: 20px; }
    .event-item { margin-bottom: 12px; }
    .countdown { color: #ffd700; font-size: 0.9em; }
  </style>
</head>
<body>
  <div class="container">
    <h1>MU Immortal - Next Events</h1>
    <div class="time" id="current-time"></div>
    <div class="event-box" id="next-events"></div>
  </div>

  <script>
    const events = [
      "00:00|Devil Square",
      "00:00|Minion EXP +30%",
      "01:00|Blood Castle",
      "02:00|Devil Square",
      "03:00|Blood Castle",
      "04:00|Devil Square",
      "05:00|Blood Castle",
      "06:00|Devil Square",
      "07:00|Blood Castle",
      "08:00|Devil Square",
      "09:00|Blood Castle",
      "10:30|Red Dragon Invasion",
      "11:00|Devil Square",
      "11:30|Guild Master Event",
      "13:00|Blood Castle",
      "13:30|Red Dragon Invasion",
      "14:00|Devil Square",
      "15:00|Blood Castle",
      "16:00|Devil Square",
      "16:30|Red Dragon Invasion",
      "17:00|Blood Castle",
      "18:00|Devil Square",
      "19:00|Blood Castle",
      "19:30|Guild Master Event",
      "20:00|Devil Square",
      "20:00|Chaos Castle (Tue)",
      "20:00|Siege War (Wed/Sat)",
      "20:30|Crywolf Fortress (Mon)",
      "21:00|Blood Castle",
      "21:30|Red Dragon Invasion",
      "22:00|Devil Square",
      "23:00|Blood Castle"
    ];

    function getTimeDifference(timeStr) {
      const [h, m] = timeStr.split(":" ).map(Number);
      const now = new Date();
      const eventTime = new Date();
      eventTime.setHours(h, m, 0, 0);
      if (eventTime < now) {
        eventTime.setDate(eventTime.getDate() + 1);
      }
      const diffMs = eventTime - now;
      const minutes = Math.floor(diffMs / 60000);
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;
      return `${hours}h ${mins}m`;
    }

    function eventMatchesToday(eventName) {
      const day = new Date().toLocaleDateString('en-US', { weekday: 'short' }); // e.g., 'Mon'
      if (!eventName.includes("(")) return true;
      const match = eventName.match(/\((.*?)\)/);
      if (!match) return true;
      const days = match[1].split("/").map(d => d.trim());
      return days.includes(day);
    }

    function updateNextEvents() {
      const now = new Date();
      const currentTime = now.toTimeString().slice(0, 5);
      document.getElementById("current-time").textContent = `Current Time: ${currentTime}`;

      let nextEvents = [];
      for (let e of events) {
        let [time, name] = e.split("|");
        if (eventMatchesToday(name)) {
          const [h, m] = time.split(":" ).map(Number);
          const eventDate = new Date();
          eventDate.setHours(h, m, 0, 0);
          if (eventDate < now) {
            eventDate.setDate(eventDate.getDate() + 1);
          }
          nextEvents.push({ time, name, eventDate });
        }
      }

      nextEvents.sort((a, b) => a.eventDate - b.eventDate);

      const eventBox = document.getElementById("next-events");
      eventBox.innerHTML = '<h2>Upcoming Events:</h2>' + nextEvents.slice(0, 3).map(ev => `
        <div class="event-item">
          <strong>${ev.name}</strong> at <strong>${ev.time}</strong><br />
          <span class="countdown">Starts in ${getTimeDifference(ev.time)}</span>
        </div>
      `).join('');
    }

    updateNextEvents();
    setInterval(updateNextEvents, 60000);
  </script>
</body>
</html>
