<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MU Immortal - Event Timers</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #111;
    color: #eee;
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    box-sizing: border-box;
  }
  h1, h2 { text-align: center; color: #f39c12; margin-top: 0; }
  .event-list {
    display: flex;
    gap: 40px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .event-box {
    border: 1px solid #444;
    padding: 15px 20px;
    border-radius: 8px;
    background-color: #1e1e1e;
    min-width: 280px;
    max-width: 450px;
    flex: 1 1 350px;
    box-sizing: border-box;
  }
  .event {
    margin: 10px 0;
    padding: 8px 5px;
    border-bottom: 1px solid #333;
  }
  .event:last-child { border-bottom: none; }
  .event-name { font-weight: bold; font-size: 1.1em; }
  .event-time, .event-timer { font-size: 0.9em; color: #aaa; }
  #user-timezone { text-align: center; margin-bottom: 15px; font-size: 0.95em; color: #ccc; }
  .up-next { text-align: center; font-size: 1.3em; color: #0f0; margin-bottom: 20px; }
  .active-events { text-align: center; font-size: 1.1em; color: #ff0; margin-bottom: 20px; }
  @media(max-width:720px){
    .event-list { flex-direction: column; gap: 25px; align-items: center; }
    .event-box { max-width:100%; }
  }
  @media(max-width:400px){
    body { font-size:14px; }
    .event-name { font-size:1em; }
    .event-time, .event-timer { font-size:0.85em; }
    .up-next { font-size:1.2em; }
    .active-events { font-size:1em; }
  }
</style>
</head>
<body>
<h1>MU Immortal - Event Timers</h1>
<div id="user-timezone"></div>
<div class="up-next" id="up-next"></div>
<div class="active-events" id="active-events"></div>
<div class="event-list">
  <div id="daily-events" class="event-box"><h2>Daily Events</h2></div>
  <div id="weekly-events" class="event-box"><h2>Weekly Events</h2></div>
</div>

<script>
const events = [
  { name:"Blood Castle", times: generateEvery2Hours("01:00","23:00"), duration:15, dayAbbr:[] },
  { name:"Devil Square", times: generateEvery2Hours("00:00","22:00"), duration:15, dayAbbr:[] },
  { name:"Red Dragon Invasion", times:["10:30","13:30","16:30","21:30"], dayAbbr:[] },
  { name:"Guild Master Event", times:["11:30","19:30"], dayAbbr:[] },
  { name:"Minion EXP +30%", times:["00:00"], duration:8, dayAbbr:[] },
  { name:"Cross-server 3v3", times:["12:00","23:30"], dayAbbr:[] },
  { name:"Frost Lord", times:["12:10","18:30"], dayAbbr:[] },
  { name:"Crywolf Fortress", times:["20:30"], dayAbbr:["Mon"] },
  { name:"Chaos Castle", times:["20:00"], dayAbbr:["Tue"] },
  { name:"Siege War", times:["20:00"], dayAbbr:["Wed","Sat"] },
  { name:"Divine Trade Route", times:["20:00","20:30"], dayAbbr:["Mon","Fri"] },
  { name:"Ethereal Pact", times:["11:00","15:00","19:00","23:00"], dayAbbr:[] },
  { name:"Golden Invasion", times:["10:00","16:00","22:00"], duration:15, dayAbbr:[] }
];

function generateEvery2Hours(start, end){
  const times = [];
  let [sh,sm]=start.split(":").map(Number);
  let [eh,em]=end.split(":").map(Number);
  for(let h=sh; h<=eh; h+=2) times.push(`${String(h).padStart(2,"0")}:${String(sm).padStart(2,"0")}`);
  return times;
}

const userTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
document.getElementById("user-timezone").textContent = `Your Timezone: ${userTz}`;

function getEventDateUTCPlus1(day, timeStr){
  const [h,m]=timeStr.split(":").map(Number);
  const utcDate=new Date(Date.UTC(day.getFullYear(),day.getMonth(),day.getDate(),h-1,m));
  return new Date(utcDate.getTime());
}

function getNextEventTime(event){
  const now = new Date();
  for(let offset=0; offset<8; offset++){
    const day = new Date(now); day.setDate(now.getDate()+offset);
    const dayAbbr = day.toLocaleDateString('en-US',{ weekday:'short' });
    if(event.dayAbbr.length && !event.dayAbbr.includes(dayAbbr)) continue;
    for(const t of event.times){
      const dt=getEventDateUTCPlus1(day,t);
      if(dt>=now) return dt;
    }
  }
  return null;
}

function isEventActive(event){
  const now = new Date();
  for(let offset=0; offset<1; offset++){
    const day = new Date(now); day.setDate(now.getDate()+offset);
    const dayAbbr = day.toLocaleDateString('en-US',{ weekday:'short' });
    if(event.dayAbbr.length && !event.dayAbbr.includes(dayAbbr)) continue;
    for(const t of event.times){
      const dt=getEventDateUTCPlus1(day,t);
      if(event.duration && now>=dt && now<=new Date(dt.getTime()+event.duration*60000)) return true;
    }
  }
  return false;
}

function formatTimeLocal(date){ return date.toLocaleTimeString([], {hour12:false,hour:"2-digit",minute:"2-digit"}); }
function formatCountdown(ms){
  const totalSeconds=Math.floor(ms/1000);
  const days=Math.floor(totalSeconds/86400);
  const hours=Math.floor((totalSeconds%86400)/3600);
  const minutes=Math.floor((totalSeconds%3600)/60);
  return `${days}d ${hours}h ${minutes}m`;
}

function renderEvents(container,filterFn){
  container.querySelectorAll(".event").forEach(e=>e.remove());
  for(const event of events.filter(filterFn)){
    const nextTime=getNextEventTime(event);
    if(!nextTime) continue;
    const localTime=formatTimeLocal(nextTime);
    const timeDiff=nextTime-new Date();
    const div=document.createElement("div");
    div.className="event";
    div.innerHTML=`<div class="event-name">${event.name}</div>
      <div class="event-time">Local: ${localTime}</div>
      <div class="event-timer">Starts in: ${formatCountdown(timeDiff)}</div>`;
    container.appendChild(div);
  }
}

function renderUpNext(){
  const now=new Date();
  let nextEvent=null, soonestTime=null;
  for(const event of events){
    const nextTime=getNextEventTime(event);
    if(!nextTime) continue;
    if(!soonestTime || nextTime<soonestTime){
      soonestTime=nextTime; nextEvent=event;
    }
  }
  if(nextEvent){
    const diff=soonestTime-now;
    document.getElementById("up-next").textContent=`Next Event: ${nextEvent.name} at ${formatTimeLocal(soonestTime)} (in ${formatCountdown(diff)})`;
  } else document.getElementById("up-next").textContent="No upcoming events.";
}

function renderActive(){
  const active = events.filter(isEventActive).map(e=>e.name);
  document.getElementById("active-events").textContent = active.length ? `Currently Active: ${active.join(", ")}` : "No events active.";
}

renderEvents(document.getElementById("daily-events"),e=>e.dayAbbr.length===0);
renderEvents(document.getElementById("weekly-events"),e=>e.dayAbbr.length>0);
renderUpNext();
renderActive();

setInterval(()=>{
  renderEvents(document.getElementById("daily-events"),e=>e.dayAbbr.length===0);
  renderEvents(document.getElementById("weekly-events"),e=>e.dayAbbr.length>0);
  renderUpNext();
  renderActive();
},60000);
</script>
</body>
</html>
