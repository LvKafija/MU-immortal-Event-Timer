<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MU Immortal - Event Timers (UTC+1)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1e1e1e;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .box {
      background: #2c2c2c;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.5);
      max-width: 500px;
      width: 100%;
    }
    .event {
      margin: 5px 0;
    }
    .highlight {
      color: #00ffcc;
      font-weight: bold;
    }
    @media (min-width: 768px) {
      .container {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
      }
      .box {
        flex: 1 1 300px;
        max-width: 400px;
      }
    }
  </style>
</head>
<body>
  <h1>MU Immortal - Event Timers (UTC+1)</h1>
  <div class="container">
    <div class="box" id="active-events">
      <h2>Currently Active</h2>
      <div id="active-list">Checking...</div>
    </div>
    <div class="box" id="up-next">
      <h2>Up Next</h2>
      <div id="up-next-event">Checking...</div>
    </div>
    <div class="box" id="all-events">
      <h2>All Events</h2>
      <div id="event-list">Loading...</div>
    </div>
  </div>

<script>
const events = [
  { name: "Blood Castle", times: ["01:00","03:00","05:00","07:00","09:00","11:00","13:00","15:00","17:00","19:00","21:00","23:00"], duration: 15 },
  { name: "Devil Square", times: ["01:00","03:00","05:00","07:00","09:00","11:00","13:00","15:00","17:00","19:00","21:00","23:00"], duration: 15 },
  { name: "Chaos Castle", times: ["12:00","18:00","22:00"] },
  { name: "Illusion Temple", times: ["14:00","20:00","00:00"] },
  { name: "Red Dragon Invasion", times: ["09:00","13:00","17:00","21:00"] },
  { name: "Golden Invasion", times: ["10:00","16:00","22:00"], duration: 15 },
  { name: "White Wizard Invasion", times: ["11:30","19:30","23:30"] },
  { name: "Vulcanus Event", times: ["Wed 20:00","Fri 20:00"] },
  { name: "Cross-Server Dragon", times: ["10:30","13:30","16:30","21:30"] },
  { name: "Divine Trade Route", times: ["Mon 20:00","Fri 20:30"] },
  { name: "Ethereal Pact", times: ["11:00","15:00","19:00","23:00"] },
];

function parseTime(timeStr) {
  const now = new Date();
  let day = now.getUTCDay();
  let [h,m] = timeStr.split(":").map(Number);

  if (timeStr.includes(" ")) {
    const [dayStr, hm] = timeStr.split(" ");
    [h,m] = hm.split(":").map(Number);
    const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    day = days.indexOf(dayStr);
  }
  return { day, hour: h, minute: m };
}

function getNextEvent(nowUTC) {
  let next = null;
  let nextTime = null;

  events.forEach(ev => {
    ev.times.forEach(t => {
      const { day, hour, minute } = parseTime(t);
      const eventTime = new Date(Date.UTC(nowUTC.getUTCFullYear(), nowUTC.getUTCMonth(), nowUTC.getUTCDate(), hour, minute));

      while (eventTime.getUTCDay() !== day && t.includes(" ")) {
        eventTime.setUTCDate(eventTime.getUTCDate() + 1);
      }
      if (eventTime < nowUTC) eventTime.setUTCDate(eventTime.getUTCDate() + 1);

      if (!nextTime || eventTime < nextTime) {
        nextTime = eventTime;
        next = { name: ev.name, time: eventTime };
      }
    });
  });
  return next;
}

function getActiveEvents(nowUTC) {
  let active = [];
  events.forEach(ev => {
    if (!ev.duration) return;
    ev.times.forEach(t => {
      const { hour, minute } = parseTime(t);
      const start = new Date(Date.UTC(nowUTC.getUTCFullYear(), nowUTC.getUTCMonth(), nowUTC.getUTCDate(), hour, minute));
      const end = new Date(start.getTime() + ev.duration*60000);
      if (nowUTC >= start && nowUTC <= end) {
        active.push(ev.name);
      }
    });
  });
  return active;
}

function render() {
  const nowUTC = new Date();
  
  const active = getActiveEvents(nowUTC);
  document.getElementById("active-list").innerHTML = active.length ? active.join(", ") : "None";
  
  const next = getNextEvent(nowUTC);
  if (next) {
    const timeStr = next.time.toUTCString().slice(17,22); 
    document.getElementById("up-next-event").innerHTML = `<span class="highlight">${next.name}</span> at ${timeStr} UTC`;
  }
  let listHTML = "";
  events.forEach(ev => {
    listHTML += `<div class="event"><span class="highlight">${ev.name}</span>: ${ev.times.join(", ")}</div>`;
  });
  document.getElementById("event-list").innerHTML = listHTML;
}

setInterval(render, 1000);
render();
</script>
</body>
</html>
